(this["webpackJsonparound-react"]=this["webpackJsonparound-react"]||[]).push([[0],{19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),r=n(13),i=n.n(r),o=(n(19),n(8)),c=n(14),u=n(5),l=n(3),d=n(0);var p=function(e){return Object(d.jsx)("section",{className:"popup ".concat(e.isClose?"popup_disable":""," popup_content_").concat(e.name),children:Object(d.jsxs)("div",{className:"popup__conainer",children:[Object(d.jsx)("button",{className:"popup__close-button",onClick:e.onClose,type:"button","aria-label":"close-form"}),Object(d.jsxs)("form",{className:"popup__form",name:e.name,onSubmit:e.onSubmit,children:[Object(d.jsx)("h2",{className:"popup__heading",children:e.title}),e.children,Object(d.jsx)("button",{className:"popup__save-button",type:"submit",children:e.submit})]})]})})};var h=function(e){var t=e.isClose,n=e.onClose,a=e.selectedCard;return Object(d.jsx)("section",{className:"popup ".concat(t&&"popup_disable"," popup_content_big-screen-image"),children:Object(d.jsxs)("div",{className:"big-screen-image",children:[Object(d.jsx)("button",{className:"popup__close-button",onClick:n,type:"button","aria-label":"close-form"}),Object(d.jsx)("img",{className:"big-screen-image__image",alt:"photo of ".concat(a.name),src:a.src}),Object(d.jsx)("p",{className:"big-screen-image__name",children:a.name})]})})},m=s.a.createContext();var j=function(e){var t=s.a.useContext(m),n=s.a.useState(t.userName),a=Object(l.a)(n,2),r=a[0],i=a[1],o=s.a.useState(t.userDescription),c=Object(l.a)(o,2),u=c[0],h=c[1];return s.a.useEffect((function(){i(t.userName),h(t.userDescription)}),[t,e.isClose]),Object(d.jsxs)(p,{isClose:e.isClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:r,profession:u})},name:"profile-edit",title:"Edit profile",submit:"Save",onClose:e.onClose,children:[Object(d.jsx)("input",{className:"popup__text-input popup__text-input_content_name",id:"input-name",value:r||"",onChange:function(e){i(e.target.value)},type:"text",placeholder:"Name",name:"name",minLength:"2",maxLength:"40",required:!0}),Object(d.jsx)("span",{className:"popup__text-input-error",id:"input-name-error"}),Object(d.jsx)("input",{className:"popup__text-input popup__text-input_content_profession",id:"input-profession",value:u||"",onChange:function(e){h(e.target.value)},type:"text",placeholder:"About me",name:"profession",minLength:"2",maxLength:"200",required:!0}),Object(d.jsx)("span",{className:"popup__text-input-error",id:"input-profession-error"})]})};var b=function(e){var t=s.a.useRef(null);return Object(a.useEffect)((function(){t.current.focus()}),[]),Object(d.jsxs)(p,{isClose:e.isClose,name:"change-profile-picture",title:"Change profile picture",submit:"Save",onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar(t.current.value),t.current.value=""},children:[Object(d.jsx)("input",{className:"popup__text-input popup__text-input_content_picture",id:"input-picture",type:"url",ref:t,placeholder:"Image link",name:"picture",required:!0}),Object(d.jsx)("span",{className:"popup__text-input-error",id:"input-picture-error"})]})};var f=function(e){var t=s.a.useState(""),n=Object(l.a)(t,2),a=n[0],r=n[1],i=s.a.useState(""),o=Object(l.a)(i,2),c=o[0],u=o[1];return s.a.useEffect((function(){r(""),u("")}),[e.isClose]),Object(d.jsxs)(p,{isClose:e.isClose,name:"add-place",title:"Add place",submit:"Save",onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlaceSubmit({name:a,link:c})},children:[Object(d.jsx)("input",{onChange:function(e){r(e.target.value)},value:a,className:"popup__text-input popup__text-input_content_place-name",id:"input-place-name",type:"text",placeholder:"Title",name:"place-name",minLength:"1",maxLength:"30",required:!0}),Object(d.jsx)("span",{className:"popup__text-input-error",id:"input-place-name-error"}),Object(d.jsx)("input",{onChange:function(e){u(e.target.value)},value:c,className:"popup__text-input popup__text-input_content_link",id:"input-link",type:"url",placeholder:"Image link",name:"link",required:!0}),Object(d.jsx)("span",{className:"popup__text-input-error",id:"input-link-error"})]})},g=n.p+"static/media/around-the-us-logo.c7581985.svg",_=n(6);var O=function(e){return s.a.useContext(m),Object(d.jsxs)("header",{className:"header",children:[Object(d.jsx)("img",{className:"header__image",src:g,id:"around-the-us-logo",alt:"around the u.s. logo"}),Object(d.jsxs)("nav",{className:"header__navigator",children:[Object(d.jsx)(_.b,{className:"header__navigator-item",to:"/",children:e.userEmail?e.userEmail:" "}),Object(d.jsx)(_.b,{className:"header__navigator-item",to:e.registrationLink.path?e.registrationLink.path:"/",onClick:function(){"Log out"===e.registrationLink.text&&e.handleLogout()},children:e.registrationLink.text})]})]})};var x=function(e){return Object(d.jsx)("div",{className:"popup",children:Object(d.jsxs)("section",{className:"registration-info",children:[Object(d.jsx)("button",{className:"registration-info__close-button popup__close-button",type:"button","aria-label":"close-form",onClick:function(){e.setRegInfoController({popup:!1})}}),Object(d.jsx)("div",{className:"registration-info__image ".concat(e.regInfoController.img?"registration-info__image_content_v":"registration-info__image_content_x")}),Object(d.jsx)("h1",{className:"regisreation-info__title",children:e.regInfoController.text})]})})};var v=function(e){s.a.useEffect((function(){e.setRegistrationLink({text:"Log in",path:"/signin"})}),[]);var t=s.a.useState(""),n=Object(l.a)(t,2),a=n[0],r=n[1],i=s.a.useState(""),o=Object(l.a)(i,2),c=o[0],u=o[1];return Object(d.jsxs)("div",{children:[Object(d.jsxs)("form",{className:"sign-up",onSubmit:function(t){t.preventDefault(),e.onRegisterSubmit({email:a,password:c})},children:[Object(d.jsx)("h1",{className:"sign-up__title",children:"Sign up"}),Object(d.jsx)("input",{className:"sign-up__email sign-up__input",placeholder:"Email",value:a||"",onChange:function(e){r(e.target.value)},type:"email",required:!0}),Object(d.jsx)("input",{className:"sign-up__password sign-up__input",placeholder:"Password",value:c||"",onChange:function(e){u(e.target.value)},type:"password",required:!0}),Object(d.jsx)("button",{className:"sign-up__submit",children:"Sign up"}),Object(d.jsx)(_.b,{to:"/signin",className:"sign-up__login-link",children:"Already a member? Log in here!"})]}),e.regInfoController.popup?Object(d.jsx)(x,{setRegInfoController:e.setRegInfoController,regInfoController:e.regInfoController}):""]})};var k=function(e){s.a.useEffect((function(){e.setRegistrationLink({text:"Sign up",path:"/signup"})}),[]);var t=s.a.useState(""),n=Object(l.a)(t,2),a=n[0],r=n[1],i=s.a.useState(""),o=Object(l.a)(i,2),c=o[0],u=o[1];return Object(d.jsxs)("form",{className:"sign-up",onSubmit:function(t){t.preventDefault(),e.onLoginSubmit({email:a,password:c})},children:[Object(d.jsx)("h1",{className:"sign-up__title",children:"Log in"}),Object(d.jsx)("input",{className:"sign-up__email sign-up__input",placeholder:"Email",value:a||"",onChange:function(e){r(e.target.value)},type:"email",required:!0}),Object(d.jsx)("input",{className:"sign-up__password sign-up__input",placeholder:"Password",value:c||"",onChange:function(e){u(e.target.value)},type:"password",required:!0}),Object(d.jsx)("button",{className:"sign-up__submit",children:"Log in"}),Object(d.jsx)(_.b,{to:"/signup",className:"sign-up__login-link",children:"Not a member yet? Sign up here!"})]})};var C=function(e){var t=s.a.useContext(m),n=!!t.userId&&!!e.card.likesArray.includes(t.userId);return Object(d.jsxs)("article",{className:"card",children:[e.card.ownerId===t.userId&&Object(d.jsx)("button",{className:"card__delete",type:"button","aria-label":"delete",onClick:function(){e.onCardDelete(e.card.cardId)}}),Object(d.jsx)("div",{className:"card__image-container",children:Object(d.jsx)("img",{className:"card__image",src:e.card.link,alt:"photo of ".concat(e.card.name),onClick:function(){e.handleCardClick({src:e.card.link,name:e.card.name})}})}),Object(d.jsxs)("div",{className:"card__details",children:[Object(d.jsx)("h2",{className:"card__name",children:e.card.name}),Object(d.jsxs)("div",{children:[Object(d.jsx)("button",{className:"card__heart ".concat(n&&"card__heart_active"),onClick:function(){e.onCardLike(e.card)},type:"button","aria-label":"like"}),Object(d.jsx)("p",{className:"card__like-number",children:e.card.likesArray.length})]})]})]})};var N=function(e){s.a.useEffect((function(){e.setRegistrationLink({text:"Log out",path:"/signin"})}),[]);var t=s.a.useContext(m);return Object(d.jsxs)("main",{className:"page__main",children:[Object(d.jsxs)("section",{className:"profile",children:[Object(d.jsxs)("div",{className:"profile__info-container",children:[Object(d.jsxs)("div",{className:"profile__avatar-container",children:[Object(d.jsx)("div",{className:"profile__edit-container",onClick:e.onEditAvatarClick}),Object(d.jsx)("img",{className:"profile__avatar",src:t.userAvatar,alt:"profile photo"})]}),Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsxs)("div",{className:"profile__name-container",children:[Object(d.jsx)("h1",{className:"profile__name",children:t.userName}),Object(d.jsx)("button",{className:"profile__edit-button",onClick:e.onEditProfileClick,type:"button","aria-label":"edit-profile"})]}),Object(d.jsx)("p",{className:"profile__proffesion",children:t.userDescription})]})]}),Object(d.jsx)("button",{className:"profile__add-button",onClick:e.onAddPlaceClick,type:"button","aria-label":"add"})]}),Object(d.jsx)("section",{className:"cards",children:e.cards.map((function(t){return Object(d.jsx)(C,{onCardDelete:e.onCardDelete,card:t,handleCardClick:e.handleCardClick,onCardLike:e.onCardLike,handleCardDelete:e.handleCardDelete},t.cardId?t.cardId:t._id)}))})]})};var y=function(){return Object(d.jsx)("footer",{className:"footer",children:Object(d.jsx)("p",{className:"footer__copyrigth",children:"\xa9 2021 Around The U.S."})})},S=n(2);var I=function(e){var t=e.children;return e.loggedIn?t:Object(d.jsx)(S.a,{to:"/signin"})},L=n(10),w=n(11),E=new(function(){function e(t){Object(L.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(w.a)(e,[{key:"setBaseUrl",value:function(e){this._baseUrl=e}},{key:"setHeaders",value:function(e){this._headers=e}},{key:"addToken",value:function(e){this._headers=Object(u.a)(Object(u.a)({},this._headers),{},{Authorization:"Bearer ".concat(e)})}},{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(t){return e._getResponseData(t)}))}},{key:"postCard",value:function(e){var t=this;return console.log(e),fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link,owner:e.owner})}).then((function(e){return t._getResponseData(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"makeLike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"makeUnlike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((function(e){return t._getResponseData(e)}))}},{key:"changeProfilePicture",value:function(e){var t=this,n=e.picture;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:n})}).then((function(e){return t._getResponseData(e)}))}},{key:"setUserInfo",value:function(e){var t=this,n=e.name,a=e.profession;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:n,about:a})}).then((function(e){return t._getResponseData(e)}))}},{key:"changeLikeCardStatus",value:function(e,t){return t?this.makeUnlike(e):this.makeLike(e)}}]),e}())({baseUrl:"https://ar-am.students.nomoreparties.sbs",headers:{"Content-Type":"application/json"}}),U=new(function(){function e(t){Object(L.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(w.a)(e,[{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"signUp",value:function(e){var t=this,n=e.password,a=e.email;return console.log(a),fetch("".concat(this._baseUrl,"/signup"),{method:"POST",headers:this._headers,body:JSON.stringify({password:n,email:a})}).then((function(e){return t._getResponseData(e)}))}},{key:"signIn",value:function(e){var t=this,n=e.password,a=e.email;return fetch("".concat(this._baseUrl,"/signin"),{method:"POST",headers:this._headers,body:JSON.stringify({password:n,email:a})}).then((function(e){return t._getResponseData(e)}))}},{key:"checkToken",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return t._getResponseData(e)}))}}]),e}())({baseUrl:"https://ar-am.students.nomoreparties.sbs",headers:{"Content-Type":"application/json"}});var D=function(){var e,t=Object(S.g)(),n=Object(a.useState)({}),r=Object(l.a)(n,2),i=r[0],g=r[1],_=s.a.useState([]),x=Object(l.a)(_,2),C=x[0],L=x[1],w=s.a.useState(!1),D=Object(l.a)(w,2),A=D[0],P=D[1],R=s.a.useState({}),T=Object(l.a)(R,2),J=T[0],q=T[1],B=s.a.useState({popup:!1}),F=Object(l.a)(B,2),W=F[0],H=F[1],z=s.a.useState(""),Y=Object(l.a)(z,2),G=Y[0],M=Y[1];function K(){return U.checkToken(localStorage.getItem("JWT")).then((function(e){if(!e.data)return t("/signin",{replace:!0}),Promise.reject(new Error("cannot find"));E.addToken(localStorage.getItem("JWT")),g(Object(u.a)(Object(u.a)({},i),{},{userName:e.data[0].name,userDescription:e.data[0].about,userAvatar:e.data[0].avatar,userId:e.data[0]._id})),M(e.data[0].email),P(!0),t("/",{replace:!0})})).catch((function(e){console.log(e)}))}s.a.useEffect((function(){K()}),[]),s.a.useEffect((function(){K().then((function(){E.getUserInfo().then((function(e){M(e.data[0].email),g(Object(u.a)(Object(u.a)({},i),{},{userName:e.data[0].name,userDescription:e.data[0].about,userAvatar:e.data[0].avatar,userId:e.data[0]._id}))})).catch((function(e){console.log(e)}))}))}),[]),s.a.useEffect((function(){K().then((function(){E.getInitialCards().then((function(e){var t=[];e.data.forEach((function(e){e.owner&&t.push({name:e.name,link:e.link,likesArray:e.likes,ownerId:e.owner.userId,cardId:e._id})})),t.reverse(),L(t)})).catch((function(e){console.log(e)}))}))}),[]),s.a.useEffect((function(){var e=function(e){"Escape"===e.key&&_e()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]);var Q=s.a.useState(!0),V=Object(l.a)(Q,2),X=V[0],Z=V[1],$=s.a.useState(!0),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ae=s.a.useState(!0),se=Object(l.a)(ae,2),re=se[0],ie=se[1],oe=s.a.useState(!0),ce=Object(l.a)(oe,2),ue=ce[0],le=ce[1],de=s.a.useState(!0),pe=Object(l.a)(de,2),he=pe[0],me=pe[1],je=s.a.useState({}),be=Object(l.a)(je,2),fe=be[0],ge=be[1];function _e(){ie(!0),Z(!0),ne(!0),me(!0),le(!0)}return Object(d.jsx)("div",{className:"App",children:Object(d.jsx)("div",{className:"page",children:Object(d.jsxs)(m.Provider,{value:i,children:[Object(d.jsx)(O,{userEmail:G,loggedIn:A,handleLogout:function(){localStorage.removeItem("JWT"),P(!1),M(""),t("/signin",{replace:!0})},registrationLink:J}),Object(d.jsxs)(S.d,{children:[Object(d.jsx)(S.b,{path:"/*",element:Object(d.jsx)(I,{loggedIn:A,children:Object(d.jsx)(N,{handleCheckToken:K,onEditProfileClick:function(){Z(!1)},onAddPlaceClick:function(){ne(!1)},onEditAvatarClick:function(){ie(!1)},handleCardClick:function(e){me(!1),ge(e)},handleCardDelete:function(){le(!1)},cards:C,onCardLike:function(e){var t=e.likesArray.includes(i.userId);E.changeLikeCardStatus(e.cardId,t).then((function(t){L(C.map((function(n){return n.cardId===e.cardId&&(n.likesArray=t.card.likes),n})))})).catch((function(e){console.log(e)}))},onCardDelete:function(e){E.deleteCard(e).then((function(){L(C.filter((function(t){return t.cardId!==e}))),_e()})).catch((function(e){console.log(e)}))},setRegistrationLink:q})})}),Object(d.jsx)(S.b,{path:"/signup",element:Object(d.jsx)(v,(e={regInfoController:W,setRegInfoController:H},Object(o.a)(e,"regInfoController",W),Object(o.a)(e,"onRegisterSubmit",(function(e){return U.signUp(e).then((function(e){if(!e)return H({popup:!0,img:!1,text:"Oops, something went wrong! Please try again."}),Promise.reject(new Error("Incorrect email or password"));H({popup:!0,img:!0,text:"Success! You have now been registered."})})).catch((function(){H({popup:!0,img:!1,text:"Oops, something went wrong! Please try again."})}))})),Object(o.a)(e,"setRegistrationLink",q),e))}),Object(d.jsx)(S.b,{path:"/signin",element:Object(d.jsx)(k,{onLoginSubmit:function(e){U.signIn(e).then((function(n){if(!n.token)return Promise.reject(new Error("Incorrect email or password"));M(e.email),localStorage.setItem("JWT",n.token),K(),P(!0),E.addToken(n.token),t("/",{replace:!0})})).catch((function(e){console.log(e)}))},setRegistrationLink:q})})]}),Object(d.jsx)(y,{}),Object(d.jsx)(j,{onUpdateUser:function(e){E.setUserInfo(e).then((function(t){_e(),g(Object(u.a)(Object(u.a)({},i),{},{userName:e.name,userDescription:e.profession}))})).catch((function(e){console.log(e)}))},isClose:X,onClose:_e}),Object(d.jsx)(f,{onAddPlaceSubmit:function(e){console.log(i),e.owner=i,console.log(e),E.postCard(e).then((function(t){e.cardId=t.data._id,e.ownerId=e.owner.userId,e.likesArray=[],L([e].concat(Object(c.a)(C))),_e()})).catch((function(e){console.log(e)}))},isClose:te,onClose:_e}),Object(d.jsx)(b,{isClose:re,onClose:_e,onUpdateAvatar:function(e){E.changeProfilePicture({picture:e}).then((function(){g(Object(u.a)(Object(u.a)({},i),{},{userAvatar:e})),_e()})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(p,{isClose:ue,name:"delete",title:"Are you sure?",submit:"Yes",onClose:_e}),Object(d.jsx)(h,{isClose:he,onClose:_e,selectedCard:fe})]})})})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),s(e),r(e),i(e)}))};i.a.render(Object(d.jsx)(s.a.StrictMode,{children:Object(d.jsx)(_.a,{children:Object(d.jsx)(D,{})})}),document.getElementById("root")),A()}},[[21,1,2]]]);
//# sourceMappingURL=main.c275cfdd.chunk.js.map